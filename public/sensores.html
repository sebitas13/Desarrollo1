<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <script src="/socket.io/socket.io.js"></script> -->
    <title>Sensor de temperatura</title>
    <!-- <link rel="stylesheet" href="style.css"> -->
    <link rel="stylesheet" href="helpers/toastr.css">
    <link rel="stylesheet" href="menu.css">
     <!-- Styles -->
     <style>

        body {
            background-color: aliceblue;
        }

        #chartdivTemp {
          box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
          width: 80%;
          height: 500px;
          max-width: 100%;
          margin: auto;
          
          margin-top: 1rem;
          
          
        }

        #chartdivHume {
          box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
          width: 80%;
          height: 500px;
          max-width: 100%;
          margin: auto;
          
          margin-top: 1rem;
          
          
        }


        .leyenda-graficas {
          box-shadow: 0 0 10px rgba(0, 0, 0, 0.3) !important;
          background-color: rgba(0, 187, 212);
          border: 1px solid #ccc;
          padding: 10px;
         
          border-radius: 5px;
          box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
        }

        /* Estilos para cada elemento de la leyenda */
        .leyenda-item {
          display: flex;
          align-items: center;
          
        }

        /* Estilos para el cuadro de color de la leyenda */
        .leyenda-color {
          width: 20px;
          height: 20px;
          margin-right: 10px;
          border: 1px solid #ccc;
          border-radius: 5px;
        }

        /* Estilos para el texto de la leyenda */
        .leyenda-texto {
          font-size: 1rem;
          color: aliceblue;
        }

        @media (max-width:720px){
          #chartdivTemp{
            font-size: 0.5rem;
            height: 350px;
            width: 300px;
          }

          #chartdivHume{
            font-size: 0.5rem;
            height: 350px;
            width: 300px;
          }
          /* .leyenda-texto{
            font-size: 0.5rem;
          } */
        }
    </style>
   
    <script src="/socket.io/socket.io.js"></script>
</head>
<body>
    <header>
        <div onclick="mostrarLateral()" id="burger" class="burger">
            <div class="barra top"></div>
            <div class="barra mid"></div>
            <div class="barra bot"></div>
        </div>

        <ul  class="menu-lateral">
            <li><a href="#">Inicio</a></li>
            <li><a href="#">Perfil de usuario</a></li>
            <li><a href="#">Ayuda y soporte</a></li>
            <li><a href="#">Acerca de</a></li>
            <li><a onclick="logout()" href="#" >Cerrar Sesion</a></li>
        </ul>

        <ul class="menu">
            
            
           
            <li>
                <a href="#">Bienvenido Sebas</a>
            </li>   
            
            <a href="menu.html"> 
                <li class="logo-ingles">
                    <img src="images/logo2.jpg" alt="">
                </li>
            </a>
        </ul> 
        
        
    </header>

    <main>


      

        <div id="chartdivTemp">
          <div class="leyenda-graficas">
            <div class="leyenda-item">
              <div class="leyenda-color" style="background-color: #6BB4D5;"></div>
              <span class="leyenda-texto">Temperatura °C</span>
            </div>
          </div>
        </div>

        <div id="chartdivHume">
          <div class="leyenda-graficas">
            <div class="leyenda-item">
              <div class="leyenda-color" style="background-color: #6BB4D5;"></div>
              <span class="leyenda-texto">Humedad %</span>
            </div>
          </div>
        </div>
        <!-- HTML -->
        
               
    </main>
    <!-- Resources -->
    <script src="https://cdn.amcharts.com/lib/5/index.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/xy.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/radar.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>

    <script src="helpers/jquery.js"></script>
    <script src="helpers/toastr.js"></script>

    <!-- Chart code -->
    <script>
      const socket = io();
      
      let lateral = document.querySelector('.menu-lateral');
      let lateral_abierto = false;
      var series;
      let lecturas_sensores = [];
      let temperatura;
      let humedad;
      var axisDataItemTemp;
      var axisDataItemHume

      socket.on('lecturas', (value)=> {

          console.log(value);

          const {
                  temp_c,
                  temp_f,
                  hume,
                  s_ter,
                  ldr,
                  pir,
                  Fecha} = JSON.parse(value);   //JSON.parse(value)

          temperatura = parseFloat(temp_c);
          humedad = parseFloat(hume);

          // temp_c.innerHTML= temp_c + ' °C';
          // tempf.innerHTML = temp_f +' °F';
          // hum.innerHTML = hume +' %';
          // st.innerHTML = s_ter +' °';
          // ld.innerHTML = ldr +' LUX';
          // p.innerHTML = pir;
          // f.innerHTML = Fecha;

          //socket.emit('enviame',"otra");
          getDate(axisDataItemTemp);
          getDateHumedad(axisDataItemHume);
      })

      function getDate(axisDataItem) {

              axisDataItem.animate({
                key: "value",
                to: temperatura,
                duration: 500,
                easing: am5.ease.out(am5.ease.cubic)
              });
      }

      function getDateHumedad(axisDataItem) {

              axisDataItem.animate({
                key: "value",
                to: humedad,
                duration: 500,
                easing: am5.ease.out(am5.ease.cubic)
              });
      }
    
      seriesTemperatura();
      seriesHumedad();

      function seriesHumedad(){
        am5.ready(function() {

              // Create root element
              // https://www.amcharts.com/docs/v5/getting-started/#Root_element
              var root = am5.Root.new("chartdivHume");

              // Set themes
              // https://www.amcharts.com/docs/v5/concepts/themes/
              root.setThemes([
                am5themes_Animated.new(root)
              ]);

              // Create chart
              // https://www.amcharts.com/docs/v5/charts/radar-chart/
              var chart = root.container.children.push(
                am5radar.RadarChart.new(root, {
                  panX: false,
                  panY: false,
                  startAngle: 180,
                  endAngle: 360
                })
              );

              chart.getNumberFormatter().set("numberFormat", "#'%'");

              // Create axis and its renderer
              // https://www.amcharts.com/docs/v5/charts/radar-chart/gauge-charts/#Axes
              var axisRenderer = am5radar.AxisRendererCircular.new(root, {
                innerRadius: -40
              });

              axisRenderer.grid.template.setAll({
                stroke: root.interfaceColors.get("background"),
                visible: true,
                strokeOpacity: 0.8
              });

              var xAxis = chart.xAxes.push(
                am5xy.ValueAxis.new(root, {
                  maxDeviation: 0,
                  min: 0,
                  max: 100,
                  strictMinMax: true,
                  renderer: axisRenderer
                })
              );

              // Add clock hand
              // https://www.amcharts.com/docs/v5/charts/radar-chart/gauge-charts/#Clock_hands
              axisDataItemHume = xAxis.makeDataItem({});

              var clockHand = am5radar.ClockHand.new(root, {
                pinRadius: 50,
                radius: am5.percent(100),
                innerRadius: 50,
                bottomWidth: 0,
                topWidth: 0
              });

              clockHand.pin.setAll({
                fillOpacity: 0,
                strokeOpacity: 0.5,
                stroke: am5.color(0x000000),
                strokeWidth: 1,
                strokeDasharray: [2, 2]
              });
              clockHand.hand.setAll({
                fillOpacity: 0,
                strokeOpacity: 0.5,
                stroke: am5.color(0x000000),
                strokeWidth: 0.5
              });

              var bullet = axisDataItemHume.set(
                "bullet",
                am5xy.AxisBullet.new(root, {
                  sprite: clockHand
                })
              );

              xAxis.createAxisRange(axisDataItemHume);

              var label = chart.radarContainer.children.push(
                am5.Label.new(root, {
                  centerX: am5.percent(50),
                  textAlign: "center",
                  centerY: am5.percent(50),
                  fontSize: "1.5em"
                })
              );

              axisDataItemHume.set("value", 50);
              bullet.get("sprite").on("rotation", function () {
                var value = axisDataItemHume.get("value");
                label.set("text", Math.round(value).toString() + "%");
              });

              setInterval(function () {
                var value = Math.round(Math.random() * 100);

                axisDataItemHume.animate({
                  key: "value",
                  to: value,
                  duration: 500,
                  easing: am5.ease.out(am5.ease.cubic)
                });

                axisRange0.animate({
                  key: "endValue",
                  to: value,
                  duration: 500,
                  easing: am5.ease.out(am5.ease.cubic)
                });

                axisRange1.animate({
                  key: "value",
                  to: value,
                  duration: 500,
                  easing: am5.ease.out(am5.ease.cubic)
                });
              }, 2000);

              chart.bulletsContainer.set("mask", undefined);

              var colorSet = am5.ColorSet.new(root, {});

              var axisRange0 = xAxis.createAxisRange(
                xAxis.makeDataItem({
                  above: true,
                  value: 0,
                  endValue: 50
                })
              );

              axisRange0.get("axisFill").setAll({
                visible: true,
                fill: colorSet.getIndex(0)
              });

              axisRange0.get("label").setAll({
                forceHidden: true
              });

              var axisRange1 = xAxis.createAxisRange(
                xAxis.makeDataItem({
                  above: true,
                  value: 50,
                  endValue: 100
                })
              );

              axisRange1.get("axisFill").setAll({
                visible: true,
                fill: colorSet.getIndex(4)
              });

              axisRange1.get("label").setAll({
                forceHidden: true
              });

              // Make stuff animate on load
              chart.appear(1000, 100);

              });
      }


      function seriesTemperatura(){
        am5.ready(function() {

            // Create root element
            // https://www.amcharts.com/docs/v5/getting-started/#Root_element
            var root = am5.Root.new("chartdivTemp");


            // Set themes
            // https://www.amcharts.com/docs/v5/concepts/themes/
            root.setThemes([
              am5themes_Animated.new(root)
            ]);


            // Create chart
            // https://www.amcharts.com/docs/v5/charts/radar-chart/
            var chart = root.container.children.push(am5radar.RadarChart.new(root, {
              panX: false,
              panY: false,
              startAngle: 160,
              endAngle: 380
            }));


            // Create axis and its renderer
            // https://www.amcharts.com/docs/v5/charts/radar-chart/gauge-charts/#Axes
            var axisRenderer = am5radar.AxisRendererCircular.new(root, {
              innerRadius: -40
            });

            axisRenderer.grid.template.setAll({
              stroke: root.interfaceColors.get("background"),
              visible: true,
              strokeOpacity: 0.8
            });

            var xAxis = chart.xAxes.push(am5xy.ValueAxis.new(root, {
              maxDeviation: 0,
              min: 0,
              max: 60,
              strictMinMax: true,
              renderer: axisRenderer
            }));


            // Add clock hand
            // https://www.amcharts.com/docs/v5/charts/radar-chart/gauge-charts/#Clock_hands
           // var axisDataItem = xAxis.makeDataItem({});
            axisDataItemTemp = xAxis.makeDataItem({});

            var clockHand = am5radar.ClockHand.new(root, {
              pinRadius: am5.percent(20),
              radius: am5.percent(100),
              bottomWidth: 40
            })

            var bullet = axisDataItemTemp.set("bullet", am5xy.AxisBullet.new(root, {
              sprite: clockHand
            }));

            xAxis.createAxisRange(axisDataItemTemp);

            var label = chart.radarContainer.children.push(am5.Label.new(root, {
              fill: am5.color(0xffffff),
              centerX: am5.percent(50),
              textAlign: "center",
              centerY: am5.percent(50),
              fontSize: "3em"
            }));

            axisDataItemTemp.set("value", 50);
            bullet.get("sprite").on("rotation", function () {
              var value = axisDataItemTemp.get("value");
              var text = Math.round(axisDataItemTemp.get("value")).toString();
              var fill = am5.color(0x000000);
              xAxis.axisRanges.each(function (axisRange) {
                if (value >= axisRange.get("value") && value <= axisRange.get("endValue")) {
                  fill = axisRange.get("axisFill").get("fill");
                }
              })

              label.set("text", Math.round(value).toString());

              clockHand.pin.animate({ key: "fill", to: fill, duration: 500, easing: am5.ease.out(am5.ease.cubic) })
              clockHand.hand.animate({ key: "fill", to: fill, duration: 500, easing: am5.ease.out(am5.ease.cubic) })
            });

            // setInterval(function () {
            //   axisDataItem.animate({
            //     key: "value",
            //     to: Math.round(Math.random() * 60 - 40),
            //     duration: 500,
            //     easing: am5.ease.out(am5.ease.cubic)
            //   });
            // }, 2000)

           // setInterval(getDate(axisDataItem), 2000)

            chart.bulletsContainer.set("mask", undefined);


            // Create axis ranges bands
            // https://www.amcharts.com/docs/v5/charts/radar-chart/gauge-charts/#Bands
            var bandsData = [{
              title: "Frio",
              color: "#0074E4",
              lowScore: 0,
              highScore: 10
            }, {
              title: "Fresco",
              color: "#00C16A",
              lowScore: 10,
              highScore: 20
            }, {
              title: "Templado",
              color: "#FFD100",
              lowScore: 20,
              highScore: 25
            }, {
              title: "Cálido",
              color: "#FF8C00",
              lowScore: 25,
              highScore: 30
            }, {
              title: "Caluroso",
              color: "#FF0000",
              lowScore: 30,
              highScore: 35
            }, {
              title: "Muy Caluroso",
              color: "#8B008B",
              lowScore: 35,
              highScore: 60
            }
          ];

            am5.array.each(bandsData, function (data) {
              var axisRange = xAxis.createAxisRange(xAxis.makeDataItem({}));

              axisRange.setAll({
                value: data.lowScore,
                endValue: data.highScore
              });

              axisRange.get("axisFill").setAll({
                visible: true,
                fill: am5.color(data.color),
                fillOpacity: 0.8
              });

              axisRange.get("label").setAll({
                text: data.title,
                inside: true,
                radius: 15,
                fontSize: "0.9em",
                fill: root.interfaceColors.get("background")
              });
            });


            // Make stuff animate on load
            chart.appear(1000, 100);

            }); // end am5.ready()
      }

      function mostrarLateral(){
                  if(!lateral_abierto){
                      lateral.setAttribute('style','left:0px')
                  }else{
                      lateral.setAttribute('style','left:-240px')
                  }
                  lateral_abierto = !lateral_abierto;
      }

      function logout(){
                  localStorage.removeItem('token');
                  toastr.options = {
                      "closeButton": false,
                      "debug": false,
                      "newestOnTop": true,
                      "progressBar": true,
                      "positionClass": "toast-bottom-full-width",
                      "preventDuplicates": true,
                      "onclick": null,
                      "showDuration": "300",
                      "hideDuration": "1000",
                      "timeOut": "2000",
                      "extendedTimeOut": "1000",
                      "showEasing": "swing",
                      "hideEasing": "linear",
                      "showMethod": "fadeIn",
                      "hideMethod": "fadeOut"
                  }
                  toastr["info"]("Cerrando sesión", "Logout")
                  setTimeout(()=>{
                      window.location.href = 'index.html';
                  },2000)     
                  
              }
      
    
           
    </script>
   
</body>
</html>



